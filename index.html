<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cool Tools Omnilist</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .links-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            padding: 20px;
        }
        .link-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .product-image {
            width: 100%;
            height: 200px;
            object-fit: contain;
            border-radius: 4px;
        }
        .stats {
            display: flex;
            gap: 20px;
            margin-top: 10px;
            color: #666;
        }
        .genius-badge {
            background: #4CAF50;
            color: white;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 14px;
            display: inline-block;
            text-decoration: none;
            cursor: pointer;
        }
        .genius-badge:hover {
            background: #45a049;
        }
        .short-url {
            color: #2196F3;
            text-decoration: none;
            font-weight: 500;
        }
        .short-url:hover {
            text-decoration: underline;
        }
        .summary {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #1a1a1a;
            margin: 0 0 20px 0;
            font-size: 2.5em;
            font-weight: 700;
        }
        .description {
            color: #444;
            font-size: 16px;
            margin-bottom: 30px;
            line-height: 1.6;
        }
        .description a {
            color: #2196F3;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.2s ease;
        }
        .description a:hover {
            color: #1976D2;
            text-decoration: underline;
        }
        .product-title {
            font-size: 16px;
            font-weight: 500;
            margin: 10px 0;
            color: #333;
        }
        .brand {
            color: #666;
            font-size: 14px;
        }
        .filters {
            display: flex;
            gap: 20px;
            margin: 20px 0;
            align-items: center;
        }
        select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            background: white;
        }
        .filter-label {
            font-weight: 500;
            color: #666;
        }
        .reset-button {
            padding: 8px 16px;
            background: #2196F3;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .reset-button:hover {
            background: #1976D2;
        }
        .period-info {
            color: #666;
            margin-bottom: 10px;
        }
        .search-input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 200px;
            font-size: 14px;
        }
        @media (max-width: 768px) {
            .filters {
                flex-direction: column;
                gap: 10px;
            }
            
            .filter-select, .search-input {
                width: 100%;
            }
            
            .links-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
                gap: 15px;
                padding: 10px;
            }
        }
        .filter-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 10px 0;
            padding: 0 20px;
        }
        .filter-tag {
            background: #e0e0e0;
            padding: 4px 8px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 14px;
        }
        .remove-tag {
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            padding: 0;
            font-size: 18px;
            line-height: 1;
        }
        .remove-tag:hover {
            color: #333;
        }
        @media (prefers-color-scheme: dark) {
            .filter-tag {
                background: #444;
                color: #fff;
            }
            .remove-tag {
                color: #aaa;
            }
            .remove-tag:hover {
                color: #fff;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="summary">
            <h1>Cool Tools Omnilist</h1>
            <div class="description">
                These are all the products we've mentioned since 2020 in <a href="https://www.recomendo.com/">Recomendo</a>, <a href="https://kk.org/cooltools/">Cool Tools</a>, our <a href="https://www.youtube.com/cooltools">
                    YouTube channel</a>, <a href="https://cooltoolsshow.libsyn.com/">podcast</a>, and other newsletters, including <a href="https://garstips.substack.com/">Gar's Tips & Tools</a>, <a href="https://nomadico.substack.com/">Nomadico</a>, <a href="https://whatsinmynow.substack.com/">What's in my NOW?</a>, <a href="https://toolsforpossibilities.substack.com/">Tools for Possibilities</a>, <a href="https://booksthatbelongonpaper.substack.com/">Books That Belong On Paper</a> and <a href="https://bookfreak.substack.com/">Book Freak</a>. Please share suggestions, corrections, and other feedback to <a href="mailto:editor@cool-tools.org">editor@cool-tools.org</a>.
            </div>
            <div class="filters">
                <input type="text" id="searchFilter" placeholder="Search products..." class="search-input">
                <div>
                    <span class="filter-label">Year:</span>
                    <select id="yearFilter">
                        <option value="all">All Years</option>
                    </select>
                </div>
                <div>
                    <span class="filter-label">Month:</span>
                    <select id="monthFilter">
                        <option value="all">All Months</option>
                        <option value="1">January</option>
                        <option value="2">February</option>
                        <option value="3">March</option>
                        <option value="4">April</option>
                        <option value="5">May</option>
                        <option value="6">June</option>
                        <option value="7">July</option>
                        <option value="8">August</option>
                        <option value="9">September</option>
                        <option value="10">October</option>
                        <option value="11">November</option>
                        <option value="12">December</option>
                    </select>
                </div>
                <div class="filters">
                    <label class="filter-label">Category:</label>
                    <select id="categoryFilter" class="filter-select">
                        <option value="all">All Categories</option>
                        <option value="tools">Tools & Hardware</option>
                        <option value="kitchen">Kitchen & Cooking</option>
                        <option value="electronics">Electronics</option>
                        <option value="office">Office & Art Supplies</option>
                        <option value="home">Home & Garden</option>
                        <option value="outdoor">Outdoor & Recreation</option>
                        <option value="health">Health & Personal Care</option>
                    </select>
                </div>
                <button class="reset-button" onclick="resetFilters()">Reset Filters</button>
            </div>
            <div class="period-info" id="periodInfo"></div>
            <div id="stats"></div>
        </div>
        <div class="loading">Loading links...</div>
        <div class="links-grid"></div>
    </div>

    <script>
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        let allLinksData = new Map();
        let availableYears = new Set();

        async function getJsonFiles() {
            try {
                // Determine if we're on GitHub Pages
                const basePath = window.location.hostname === 'coconutlampshade.github.io' ? '/cooltools' : '';
                
                // Instead of trying to list the directory, use a predefined list of years
                const years = [2020, 2021, 2022, 2023, 2024, 2025];
                const files = years.map(year => 
                    `genius_links_${year}-01-01_to_${year}-12-31.json`
                );
                
                years.forEach(year => availableYears.add(year));
                
                return files;
            } catch (error) {
                console.error('Error getting file list:', error);
                return [];
            }
        }

        function updateYearOptions() {
            const yearSelect = document.getElementById('yearFilter');
            yearSelect.innerHTML = '<option value="all">All Years</option>';
            Array.from(availableYears).sort().forEach(year => {
                yearSelect.innerHTML += `<option value="${year}">${year}</option>`;
            });
        }

        function inferCategory(product) {
            const name = (product.ProductDisplayName1 + ' ' + product.ProductDisplayName2).toLowerCase();
            
            const categories = {
                tools: ['tool', 'screwdriver', 'wrench', 'drill', 'hammer', 'saw', 'plier', 'knife', 
                        'cutter', 'measure', 'level', 'clamp', 'workbench', 'socket', 'bit'],
                kitchen: ['kitchen', 'cook', 'food', 'knife', 'pan', 'pot', 'utensil', 'spatula', 
                         'spoon', 'fork', 'plate', 'bowl', 'coffee', 'tea', 'blender', 'mixer'],
                electronics: ['cable', 'charger', 'adapter', 'electronic', 'power', 'battery', 'light',
                             'led', 'usb', 'phone', 'computer', 'laptop', 'tablet', 'camera'],
                office: ['pen', 'pencil', 'paper', 'notebook', 'desk', 'office', 'stapler', 'tape',
                        'marker', 'eraser', 'art', 'paint', 'brush', 'canvas'],
                home: ['home', 'furniture', 'decor', 'storage', 'organizer', 'shelf', 'lamp', 'rug',
                      'curtain', 'pillow', 'blanket', 'towel', 'cleaning'],
                outdoor: ['outdoor', 'garden', 'camping', 'hiking', 'bike', 'sport', 'grill', 'patio',
                         'lawn', 'plant', 'seed', 'tool'],
                health: ['health', 'personal', 'care', 'beauty', 'vitamin', 'supplement', 'medical',
                        'first aid', 'massage', 'fitness', 'exercise']
            };

            // Check which category keywords match the product name
            for (const [category, keywords] of Object.entries(categories)) {
                if (keywords.some(keyword => name.includes(keyword))) {
                    return category;
                }
            }
            
            return 'other'; // Default category if no matches
        }

        function updateFilterTags() {
            const tagsContainer = document.createElement('div');
            tagsContainer.className = 'filter-tags';
            
            const year = document.getElementById('yearFilter').value;
            const month = document.getElementById('monthFilter').value;
            const category = document.getElementById('categoryFilter').value;
            const search = document.getElementById('searchFilter').value;
            
            if (year !== 'all') {
                addFilterTag(tagsContainer, `Year: ${year}`, () => {
                    document.getElementById('yearFilter').value = 'all';
                    filterLinks();
                });
            }
            
            if (month !== 'all') {
                const monthName = document.getElementById('monthFilter').options[document.getElementById('monthFilter').selectedIndex].text;
                addFilterTag(tagsContainer, `Month: ${monthName}`, () => {
                    document.getElementById('monthFilter').value = 'all';
                    filterLinks();
                });
            }
            
            if (category !== 'all') {
                const categoryName = document.getElementById('categoryFilter').options[document.getElementById('categoryFilter').selectedIndex].text;
                addFilterTag(tagsContainer, `Category: ${categoryName}`, () => {
                    document.getElementById('categoryFilter').value = 'all';
                    filterLinks();
                });
            }
            
            if (search) {
                addFilterTag(tagsContainer, `Search: ${search}`, () => {
                    document.getElementById('searchFilter').value = '';
                    filterLinks();
                });
            }
            
            const existingTags = document.querySelector('.filter-tags');
            if (existingTags) {
                existingTags.remove();
            }
            
            if (tagsContainer.children.length > 0) {
                document.querySelector('.filters').after(tagsContainer);
            }
        }

        function addFilterTag(container, text, onRemove) {
            const tag = document.createElement('span');
            tag.className = 'filter-tag';
            tag.innerHTML = `
                ${text}
                <button class="remove-tag" aria-label="Remove filter">&times;</button>
            `;
            tag.querySelector('button').onclick = onRemove;
            container.appendChild(tag);
        }

        function filterLinks() {
            const searchTerm = document.getElementById('searchFilter').value.toLowerCase();
            let filteredLinks = Array.from(allLinksData.values());
            
            // Filter out category/browse pages and links with missing metadata
            filteredLinks = filteredLinks.filter(link => {
                // Filter out browse/category pages
                if (link.ProductUrl.includes('/b/') || 
                    link.ProductUrl.includes('node=') ||
                    link.ProductDisplayName1.includes('amazon.com/b/') ||
                    link.ProductArtworkThumbnailUrl.includes('image_unavailable')) {
                    return false;
                }
                return true;
            });
            
            // Apply year/month filters
            const year = document.getElementById('yearFilter').value;
            const month = document.getElementById('monthFilter').value;
            const category = document.getElementById('categoryFilter').value;
            if (year !== 'all' || month !== 'all') {
                filteredLinks = filteredLinks.filter(link => {
                    const dateStr = link.CreatedUtc;
                    const timestamp = parseInt(dateStr.replace('/Date(', '').replace(')/', ''));
                    const date = new Date(timestamp);
                    return (year === 'all' || date.getFullYear() === parseInt(year)) &&
                           (month === 'all' || date.getMonth() + 1 === parseInt(month));
                });
            }

            // Apply category filter
            if (category !== 'all') {
                filteredLinks = filteredLinks.filter(link => 
                    inferCategory(link) === category
                );
            }

            filteredLinks = filteredLinks.filter(link => 
                link.ProductDisplayName1.toLowerCase().includes(searchTerm) ||
                link.ProductDisplayName2.toLowerCase().includes(searchTerm)
            );

            // Replace the TotalClicks sort with a random sort
            filteredLinks.sort(() => Math.random() - 0.5);

            let periodText = 'Showing: ';
            if (category !== 'all') {
                const categoryName = document.getElementById('categoryFilter').options[document.getElementById('categoryFilter').selectedIndex].text;
                periodText += `${categoryName} - `;
            }
            if (year === 'all' && month === 'all') periodText += 'All Time';
            else if (year === 'all') periodText += `All ${document.getElementById('monthFilter').options[document.getElementById('monthFilter').selectedIndex].text}s`;
            else if (month === 'all') periodText += `All of ${year}`;
            else periodText += `${document.getElementById('monthFilter').options[document.getElementById('monthFilter').selectedIndex].text} ${year}`;
            document.getElementById('periodInfo').textContent = periodText;

            const linksGrid = document.querySelector('.links-grid');
            linksGrid.innerHTML = '';
            if (filteredLinks.length === 0) {
                linksGrid.innerHTML = `
                    <div class="no-results">
                        <h3>No products found</h3>
                        <p>Try adjusting your filters or search terms</p>
                    </div>
                `;
            } else {
                filteredLinks.forEach(link => {
                    const card = document.createElement('div');
                    card.className = 'link-card';
                    card.innerHTML = `
                        <img src="${link.ProductArtworkThumbnailUrl150}" alt="${link.ProductDisplayName1}" class="product-image">
                        <div class="product-title">${link.ProductDisplayName1}</div>
                        <div class="brand">${link.ProductDisplayName2}</div>
                        <div class="stats">
                            <a href="https://geni.us/${link.ShortUrlCode}" target="_blank" class="genius-badge">Get it</a>
                        </div>
                    `;
                    linksGrid.appendChild(card);
                });
            }

            updateFilterTags();
        }

        function resetFilters() {
            document.getElementById('yearFilter').value = 'all';
            document.getElementById('monthFilter').value = 'all';
            document.getElementById('searchFilter').value = '';
            document.getElementById('categoryFilter').value = 'all';
            filterLinks();
        }

        async function loadAllLinks() {
            const loading = document.querySelector('.loading');
            
            try {
                const files = await getJsonFiles();
                const basePath = window.location.hostname === 'coconutlampshade.github.io' ? '/cooltools' : '';
                updateYearOptions();
                
                if (files.length === 0) {
                    loading.innerHTML = 'No data files found in the links directory.';
                    return;
                }

                for (const file of files) {
                    try {
                        const response = await fetch(`${basePath}/links/${file}`);
                        const data = await response.json();
                        
                        data.Results.forEach(link => {
                            if (!allLinksData.has(link.Id) || 
                                new Date(link.CreatedUtc) > new Date(allLinksData.get(link.Id).CreatedUtc)) {
                                allLinksData.set(link.Id, link);
                            }
                        });
                    } catch (e) {
                        console.error(`Error loading ${file}:`, e);
                    }
                }
                
                loading.style.display = 'none';
                filterLinks();
                
                document.getElementById('searchFilter').addEventListener('input', debounce(filterLinks, 300));
                document.getElementById('yearFilter').addEventListener('change', filterLinks);
                document.getElementById('monthFilter').addEventListener('change', filterLinks);
                document.getElementById('categoryFilter').addEventListener('change', filterLinks);
                
            } catch (error) {
                loading.innerHTML = `Error loading links: ${error.message}`;
            }
        }

        loadAllLinks();
    </script>
</body>
</html>